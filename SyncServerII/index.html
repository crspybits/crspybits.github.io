<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>SyncServerII</title> 

    <!-- Bootstrap core CSS -->
    <link href="bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="jumbotron.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <style>
      p {
        font-size:14pt;
      }
      
      .row-striped:nth-of-type(odd){
        background-color: #efefef;
      }

      .row-striped:nth-of-type(even){
        background-color: #F0F8FF;
      }
      
      .padded {
        padding: 1em;
      }
      
      /* For the *destination* of an in-document anchor */
      a.anchor {
          display: block;
          position: relative;
          top: -50px;
          visibility: hidden;
      }
      
      ol, ul {
        font-size:16pt;
      }
      
      li {
        padding-top:2pt;
      }
    </style>
  </head>
  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://github.com/crspybits/SyncServerII">SyncServerII</a>
        </div>
      </div>
    </nav>

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container">
        <h1>SyncServerII</h1>
        <p>Main goals</p>
        <ul>
          <li>Synchronize a mobile appâ€™s data across mobile devices and user-owned cloud storage systems (e.g., Google Drive), and</li>
          <li>Enable mobile app users to safely share that cloud data with other users (e.g., Google, Facebook, Dropbox).</li>
        </ul>
      </div>
    </div>

    <div class="container">
      <!-- Example row of columns -->
      <div class="row row-striped padded">
        <h2>Contents:</h2>
        <h3><a href="#DEVSTATUS">Development Status</a></h3>
        <h3><a href="#INSTALLSERVER">Standing up a Server</a></h3>
        <h3><a href="#INSTALLAPP">Installation in a new iOS app</a></h3>
        <h3><a href="#GOOGLE">Using Google Drive and Google Sign-In (optional)</a></h3>
        <h3><a href="#FACEBOOK">Using Facebook Sign-In (optional)</a></h3>
        <h3><a href="#DROPBOX">Using Dropbox Sign-In (optional)</a></h3>
        <h3><a href="#FURTHERREADING">Further Reading & Viewing</a></h3>
      </div>
      
      <a class="anchor" id="DEVSTATUS"></a>
      <div class="row row-striped padded">
        <h2>Development Status</h2>
        <ul>
          <li>Google Drive and Dropbox are supported in terms of cloud storage systems.</li>
          <li>Google, Dropbox, and Facebook sign-in's are supported (Facebook is only for sharing; Dropbox is only for owning).</li>
          <li>Optimistic synchronization is used for ensuring clients have a consistent view of data (e.g., <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.8.7606&rep=rep1&type=pdf">see</a>).</li>
          <li>Sharing can be done with permissions of read, write (includes read), or admin (read, write and invite others to share).</li>
          <li>Multi-version files and multi-version per-file meta data.</li>
          <li>File content conflicts and meta-data conflicts are resolved with
            with application defined conflict resolution rules.</li>
          <li>Support for application-specific groups of files so that downloads are presented to applications in terms of changes to those groups.</li>
          <li>Builds of releases of the server are published to <a href="https://hub.docker.com/r/crspybits/syncserver-runner/">hub.docker.</a>.</li>
          <li>An example server is currently running on the AWS Elastic Beanstalk, 
              supporting the <a href="http://github.com/crspybits/SharedImages">SharedImages</a> iPhone/iPad app</li>

          <li>Repos for this system are:</li>
            <ul>
              <li><a href="https://github.com/crspybits/SyncServerII">SyncServerII server</a></li>
              
              <li><a href="https://github.com/crspybits/SyncServer-Shared">Swift files shared between client and server</a></li>
                In the form of a Cocoapod.
              
              <li><a href="https://github.com/crspybits/SyncServer-iOSClient">iOS Client for the SyncServer server.</a></li>
              
              <li><a href="http://github.com/crspybits/SharedImages">SharedImages</a></li>
                Demo iOS app-- Uses the <a href="https://github.com/crspybits/SyncServer-iOSClient">iOS Client</a>, enables images and discussion threads to be synchronized across mobile devices &amp; user-owned cloud storage, enables safe sharing of those images with others, and safe sharing of discussion threads.
            </ul>
        </ul>  
      </div>
      
      <a class="anchor" id="INSTALLSERVER"></a>
      <div class="row row-striped padded">
        <h2>Standing up a Server</h2>

        <p>Each separate mobile app needs its own server. That is, for iOS, each app with a separate bundle id needs its own server.</p>

        <p>I have gone through a few incarnations of methods for installing the server, each of them on AWS. Currently, I am using a Docker image, and also use AWS Elastic Beanstalk. <a href="runningServerOnEC2.html">Previously, I was building the server directly on an AWS EC2 instance.</a></p>

        <p>The two basic parts of my current deployment method are described below.</p>

        <h3>Docker</h3>
        <p><a href="https://www.docker.com">Docker</a> is now central to my testing and deployment process for the server.
          For testing, I use the <a href="https://github.com/crspybits/SyncServerII/blob/master/devops/Docker/Building/Dockerfile">same Docker image that I use for building</a>.
        </p>

        <p>On my system, the following command launches that Docker image:</p>
        <code>docker run --rm -i -t -v /Users/chris/Desktop/Apps/:/root/Apps crspybits/swift-ubuntu:4.0.0</code>
        <p>And, of course, the path `/Users/chris/Desktop/Apps/` is specific to my system.</p>

        <p>And this builds the server:</p>
        <code>swift build -Xswiftc -DDEBUG -Xswiftc -DSERVER</code>
        <p></p>
        <p>For runtime, I use <a href="https://github.com/crspybits/SyncServerII/blob/master/devops/Docker/Runtime/Dockerfile"> this Docker base-image</a> 
        and I <a href="https://github.com/crspybits/SyncServerII/blob/master/devops/release.sh">run the script</a> to create a Docker image for a specific release of the SyncServerII server code. Those release builds of the server Docker images live at <a href="https://hub.docker.com/r/crspybits/syncserver-runner/">hub.docker.</a>
        </p>

        <h3>AWS Elastic Beanstalk</h3>
        <p>I use <a href="https://aws.amazon.com/elasticbeanstalk/">AWS's Elastic Beanstalk</a> for reasons including: 
          <ol style="list-style-type: lower-alpha">
            <li>ease of deploying new versions of my server</li>
            <li>its ability to run servers from Docker images</li>
            <li>the relative ease of spinning up (and down) of new server environments-- so I can create and use a staging or testing environment for just a few hours</li>
            <li>my (potential) eventual need for scaling the server to deal with a larger load from client apps.</li>
          </ol>
        </p>
        <p>
        My <a href="https://github.com/crspybits/SyncServerII/blob/master/devops/AWS-ElasticBeanstalk/Docs/LaunchingEnvironment.md">deployment process to the AWS Elastic Beanstalk</a> takes several steps, some of them manual.
        </p>
      </div>
      
      <a class="anchor" id="INSTALLAPP"></a>
      <div class="row row-striped padded">
        <h2>Installation in a new iOS app</h2>

        <p>The best instructions for setting up a new iOS app are likely found by looking over the <a href="http://github.com/crspybits/SharedImages">SharedImages</a> app, but some details are also given below.</p>
        
        <p>The <a href="https://github.com/crspybits/SyncServer-iOSClient">example app in the iOS client repo</a> can also provide some information on setting up your iOS app.</p>

        <ol id="PODFILE">
          <li>Setup your <em>Podfile</em>. </li>
              The SyncServer iOS client API is a Cocoapod. Google is the only possibility currently for cloud storage, and thus the Google SignIn Cocoapod is required. Facebook can be used to allow shared sign-in's, and is optional.
          
<pre>
source 'https://github.com/CocoaPods/Specs.git'
source 'https://github.com/crspybits/Specs.git'

use_frameworks!

target 'YourApp' do
    # The iOS client.
    pod 'SyncServer'
    
    # Only needed if you are allowing Facebook users to share.
    pod 'SyncServer/Facebook'

    # Only needed if you are using Dropbox for cloud storage
    pod 'SyncServer/Dropbox'
    
    # For cloud storage and shared sign-in's with Google Drive/Google.
    pod 'GoogleSignIn', '4.1'
    
    target 'YourAppTests' do
        inherit! :search_paths
    end
end
</pre>
          
          <li>Drag the `GoogleSignIn.swift` file into your project</li>
            Due to technical issues, you will need to separately download the iOS client repo, and do this (The Google sign-in Cocoapod uses a static library and this causes transitive dependency issues if the GoogleSignIn pod is included in the SyncServer pod). Do:
          <pre>git clone https://github.com/crspybits/SyncServer-iOSClient.git</pre>
          Drag `SyncServer-iOSClient/Client/SignIn/GoogleSignIn.swift` into your Xcode project.
                    
          <li>Additions to your AppDelegate</li>
          
          <ol type="a">
            <li>Add the following import</li>
              <pre>import SyncServer</pre>

            <li>Setup your sign-in's in the didFinishLaunchingWithOptions method</li>
               At a minimum, this will involve:
<pre>
let googleSignIn = GoogleSyncServerSignIn(serverClientId: serverClientId, appClientId: appClientId)
SignInManager.session.addSignIn(googleSignIn, launchOptions: options)        
</pre>

            If you are also using Facebook sign-in, you'll need:
<pre>
let facebookSignIn = FacebookSyncServerSignIn()
SignInManager.session.addSignIn(facebookSignIn, launchOptions: options)
</pre>     

            if you are also using Dropbox sign-in, you'll need:
<pre>
let dropboxSignIn = DropboxSyncServerSignIn(appKey: dropboxAppKey)
SignInManager.session.addSignIn(dropboxSignIn, launchOptions: options)
</pre>
            
              <div style="position:relative; left: 2em;">
              Where: <em>serverClientId</em> and <em>appClientId</em> come from setting up your app with Google. See below.
              </div>
            
            <li>Also in the didFinishLaunchingWithOptions method, you need to call</li>
              <pre>SyncServer.session.appLaunchSetup(withServerURL: serverURL, cloudFolderName:cloudFolderName)</pre>
              <div style="position:relative; left: 2em;">
              Where: 
              <ul>
                <li><em>serverURL</em> is the URL of your SyncServer server. </li>

                <li><em>cloudFolderName</em> is the folder name (not a path, just a folder) within Google Drive in which your files will be stored (if you are using Google Drive). Dropbox, if you are using that, doesn't need this.</li> 
                  E.g., I'm using "SharedImages.Folder" for the SharedImages app.  
              </ul>
              </div>
                    
            <li>Add the following into the app:open:options: method</li>
<pre>
func application(_ app: UIApplication, open url: URL, options: [UIApplicationOpenURLOptionsKey : Any] = [:]) -> Bool {
    return SignInManager.session.application(app, open: url, options: options) ||
    SharingInvitation.session.application(app, open: url, options: options)
}
</pre>         

            <li>To enable background downloading/uploading add this into your AppDelegate</li>
<pre>
func application(_ application: UIApplication, handleEventsForBackgroundURLSession identifier: String, completionHandler: @escaping () -> Void) {
  SyncServer.session.application(application, handleEventsForBackgroundURLSession: identifier, completionHandler: completionHandler)
}
</pre>
          </ol>
          
          <li>Setup the <em>SharingInvitationDelegate</em> to deal with sharing invitations received.</li>
              For an example of how this is done, look in the <a href="http://github.com/crspybits/SharedImages">SharedImages</a> app.
          
          <li>Setup the UI for sign-in's in your app.</li>
          	<ol type="a">
              You will need to do this for at least Google.
                    For an example of how this is done, look in the <a href="http://github.com/crspybits/SharedImages">SharedImages</a> app.
              <li>Call the `setupSignInButton` and setup delegates for your selected sign-ins. For example:</li>
<pre>
// For the GoogleSyncServerSignIn, the delegate in this params argument must a view controller abiding by GoogleSignInUIProtocol
let googleSignInButton = googleSignIn.setupSignInButton(params: ["delegate": self])
googleSignIn.delegate = self // abiding by GenericSignInDelegate

// If you are using Facebook sign-in:
let facebookSignInButton = facebookSignIn.setupSignInButton(params:nil)
// Just to balance out the lengths of the sign-in buttons-- the Google button is shorter.
facebookSignInButton.frameWidth = googleSignInButton.frameWidth
facebookSignIn.delegate = self

// If you are using Dropbox sign-in:
let dropboxSignInButton = dropboxSignIn.setupSignInButton(params: ["viewController": self])
dropboxSignInButton.frameSize = CGSize(width: googleSignInButton.frameWidth, height: googleSignInButton.frameHeight * 0.75)
dropboxSignIn.delegate = self
</pre>
              
              <li>For convenience if you are using multiple sign-in's (say, Google, Facebook, and Dropbox), the SyncServer SignIn widget will enable you to display the sign-in's automatically.</li>
              
<pre>
let signIn:SignIn = SignIn.createFromXib()!
// and add this SignIn view into an appropriate view controller in your UI.
</pre>
              The SignIn view uses the SyncServer SignInManager to determine which sign-in buttons to display. The <a href="http://github.com/crspybits/SharedImages">SharedImages</a> app uses the SignIn view, so see that for additional code details.
          	</ol>
        </ol>
      </div>
      
      <a class="anchor" id="GOOGLE"></a>
      <div class="row row-striped padded">
        <h2>Using Google Drive and Google Sign-In (optional)</h2>
        <ol>
          <li>Create Google App/Developer Credentials</li>
            To enable access to user Google Drive accounts, you must create Google Developer credentials for your iOS app and SyncServer server. These credentials need to be installed in your app making use of the SyncServer client Framework. Go to <a href="https://developers.google.com/identity/sign-in/ios/start">https://developers.google.com/identity/sign-in/ios/start</a> and click on `GET A CONFIGURATION FILE`. 
            <p></p>
            <p>You need to generate a configuration file-- this will typically be named: `GoogleService-Info.plist`, and add that file to your Xcode project. Amongst other information, this .plist file contains the Google `CLIENT_ID` for your iOS app.</p>

          <li>You also need to make sure you enable the Google Drive API for your Google project.</li>
           You can do this by going to <a href="https://console.developers.google.com">https://console.developers.google.com</a>, looking for `ENABLE API`, and then `Drive API`.
          
          <li>Obtain your `OAuth 2.0 client IDs`.</li>
            Within <a href="https://console.developers.google.com">https://console.developers.google.com</a>, you also need to obtain the `OAuth 2.0 client IDs` for your `Web client` (see under "Credentials).
            I call this the `GoogleServerClientId`. You will need both the `CLIENT_ID` (for your iOS app) and the `GoogleServerClientId` (for the SyncServer server) in order for users to sign in to Google Drive from your iOS app.
          
          <li>Add URL scheme for Google Sign in to your app.</li>
            You do this in XCode under the "Info" tab. Look for "URL Types" and paste the CLIENT_ID into the "URL Schemes" field of a new URL Type (press the "+" button).
        </ol>
      </div>

      <a class="anchor" id="FACEBOOK"></a>
      <div class="row row-striped padded">
        <h2>Using Facebook Sign-In (optional)</h2>
        <ol>
          <li>Create a new Facebook app</li>
            To do this, go to <a href="https://developers.facebook.com">https://developers.facebook.com</a>.
            You will need to sign in with a Facebook account. If you don't already have one, you'll have to make one.
          
            After signing in, in the upper right, under "My Apps", click on "Add a New App". Follow the instructions. They're pretty good.
          
          <li>For the Server: ClientId and Secret.</li>
            You will need the Facebook ClientId (App ID) and Secret (App Secret) for the SyncServer server Server.json file from your new app on <a href="https://developers.facebook.com">https://developers.facebook.com</a>.
        </ol>        
      </div>

      <a class="anchor" id="DROPBOX"></a>
      <div class="row row-striped padded">
        <h2>Using Dropbox Sign-In and Cloud Storage (optional)</h2>
        <ol>
          <li>Register your application with Dropbox</li>
            To do this, use <a href="https://www.dropbox.com/developers/apps">this Dropbox link</a>. The <a href="https://github.com/dropbox/SwiftyDropbox#get-started">more general Dropbox docs are here</a>.
          <li>Configure your project</li>
          You will need to then follow the steps under "Configure your project" in the <a href="https://github.com/dropbox/SwiftyDropbox#get-started">more general Dropbox docs</a>. You do *not* need to explicitly include the Dropbox Cocoapod in your Podfile for your Xcode project if you have followed the above <a href="#PODFILE">Podfile instructions</a>.
        </ol>        
      </div>
      
      <a class="anchor" id="FURTHERREADING"></a>
      <div class="row row-striped padded">
        <h2>Further Reading</h2>
        <ol>
            <li>Talk given at roster technologies brown bag lunch series (2/6/18)</li>
            <a href="presentations/SyncServerII-2-6-18.pptx">PowerPoint slides</a>
            <a href="https://youtu.be/VK_nKxd6njo">YouTube video.</a>

          <li>Talk given to the Boulder iOS Meetup (11/21/17)</li>
            <a href="presentations/SyncServerII-11-21-17.pptx">PowerPoint slides</a>
            <a href="https://youtu.be/Xid_vZ3nlCQ">YouTube video (teaser-- first 10 minutes! :) ).</a>
          
          <li>Talk given to the Denver Open Source Users Group (8/1/17)</li>
            <a href="presentations/SyncServerII-8-1-17.pptx">PowerPoint slides</a>
          
          <li>Blog articles on SyncServer development</li>
          <ol type="a">
            <li><a href="http://www.spasticmuffin.biz/blog/2017/11/18/the-client-side-syncserver-sign-in-system-making-sign-in-sticky/">The Client-Side SyncServer Sign-In System: Making Sign-in Sticky</a> (10/23/17)</li>
            
            <li><a href="http://www.spasticmuffin.biz/blog/2017/09/15/making-downloads-more-flexible-in-the-syncserver/">Making Downloads More Flexible in the SyncServer</a> (9/15/17)</li>
            
            <li><a href="http://www.spasticmuffin.biz/blog/2016/09/03/to-lock-or-not-to-lock-in-the-smsyncserver/">To Lock or Not to Lock in the SMSyncServer</a> (9/3/16)</li>
            
            <li><a href="http://www.spasticmuffin.biz/blog/2016/05/11/conflict-management-in-the-smsyncserver/">Conflict Management in the SMSyncServer</a> (5/11/16)</li>
            
            <li><a href="http://www.spasticmuffin.biz/blog/2016/05/09/re-architecting-the-smsyncserver-file-system/">Re-Architecting the SMSyncServer File System</a> (5/9/16)</li>

            <li><a href="http://www.spasticmuffin.biz/blog/2016/04/26/the-many-senses-of-recovery-in-smsyncserver/">The Many Senses of Recovery in SMSyncServer</a> (4/26/16)</li>
            
            <li><a href="http://www.spasticmuffin.biz/blog/2016/04/02/design-issue-changing-cloud-storage-accounts-with-the-smsyncserver/">Design Issue: Changing Cloud Storage Accounts With The SMSyncServer</a> (4/2/16)</li>
            
            <li><a href="http://www.spasticmuffin.biz/blog/2016/01/21/blitz-to-get-smsyncserver-ready-for-open-source/">Blitz to get SMSyncServer Ready for Open-Source</a> (1/21/16)</li>
            
            <li><a href="http://www.spasticmuffin.biz/blog/2015/12/29/the-syncserver-permanent-access-to-your-app-data/">The SyncServer: Permanent Access to Your App Data</a> (12/29/15)</li>
          </ol>
        </ol>        
      </div>
      
      <hr>

      <footer>
        <p>&copy; SyncServer and associated software is MIT licensed.</p>
      </footer>
    </div> <!-- /container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="jquery.min.js"><\/script>')</script>

    <script src="bootstrap.min.js"></script>
    
    <script src="ie10-viewport-bug-workaround.js"></script>
  </body>
</html>